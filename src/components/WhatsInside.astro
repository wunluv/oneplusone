---
import { Image } from "astro:assets";

import { book } from "../config.json";
---

<link
  href="//cdn-images.mailchimp.com/embedcode/classic-061523.css"
  rel="stylesheet"
  type="text/css"
/>
<script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("mc-embedded-subscribe-form");

    form.addEventListener("submit", function (e) {
      e.preventDefault(); // Prevent the default form submission

      // Serialize form data to a query string
      const formData = new FormData(form);
      const serializedData = new URLSearchParams(formData).toString();

      // Define the JSONP callback function name
      const callbackName = "handleMailchimpResponse";

      // Define the JSONP URL with callback parameter
      const jsonpUrl =
        "https://khanyi.us11.list-manage.com/subscribe/post?u=71ac69d566f8d01607128be3e&amp;id=79f4a91ad0&amp;f_id=005f17e1f0" +
        serializedData +
        "&c=" +
        callbackName;

      // Create a script element for JSONP
      const script = document.createElement("script");
      script.src = jsonpUrl;

      // Define the JSONP callback function
      window[callbackName] = function (response) {
        // Handle the JSONP response as needed
        if (response.result === "success") {
          console.log("Form submitted successfully.");
          // You can redirect or display a success message here
        } else {
          console.error("Form submission failed.");
          // Handle errors here
        }

        // Clean up by removing the script element and callback function
        document.body.removeChild(script);
        delete window[callbackName];
      };

      // Append the script element to the document to initiate the JSONP request
      document.body.appendChild(script);
    });
  });
</script>
<script
  type="text/javascript"
  src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"
></script><script type="text/javascript">
  (function ($) {
    window.fnames = new Array();
    window.ftypes = new Array();
    fnames[0] = "EMAIL";
    ftypes[0] = "email";
    fnames[3] = "ADDRESS";
    ftypes[3] = "address";
    fnames[4] = "PHONE";
    ftypes[4] = "phone";
    fnames[5] = "BIRTHDAY";
    ftypes[5] = "birthday";
    fnames[6] = "COMPANY";
    ftypes[6] = "text";
  })(jQuery);
  var $mcj = jQuery.noConflict(true);
</script>
<div class="bg-book-gray relative overflow-hidden">
  <div class="max-w-screen-xl mx-auto pt-16 pb-8 text-lg">
    <div class="hidden sm:block sm:absolute sm:inset-0">
      <svg
        class="absolute bottom-0 right-0 transform translate-x-1/2 mb-48 text-gray-700 lg:top-0 lg:mt-28 lg:mb-0 xl:transform-none xl:translate-x-0"
        width="364"
        height="384"
        viewBox="0 0 364 384"
        fill="none"
        ><defs
          ><pattern
            id="eab71dd9-9d7a-47bd-8044-256344ee00d0"
            x="0"
            y="0"
            width="20"
            height="20"
            patternUnits="userSpaceOnUse"
            ><rect x="0" y="0" width="4" height="4" fill="currentColor"></rect>
          </pattern>
        </defs><rect
          width="364"
          height="384"
          fill="url(#eab71dd9-9d7a-47bd-8044-256344ee00d0)"></rect>
      </svg>
    </div><div class="relative z-10">
      <h2 class="text-5xl mb-10 font-semibold text-gray-50 px-4">
        What's <span class="text-book-theme pl-4">Next?</span><!-- -->
      </h2><div class="flex-none sm:flex">
        <div class="text-base sm:flex-1 px-4">
          <ol class="text-gray-400 ml-4 mb-4 font-body">
            <li class="text-lg mb-2 text-gray-100 font-semibold">
              The book is currently in the editing phase. Drop your email below
              and get a notification when the book is released. All subscribers
              will receive a discount on release!
            </li>
          </ol>

          <div class="sm:col-span-2">
            <h1
              class="max-w-lg text-xl font-semibold tracking-tight text-gray-200 xl:text-2xl dark:text-white"
            >
              Subscribe for updates
            </h1>

            <form
              action="https://khanyi.us11.list-manage.com/subscribe/post?u=71ac69d566f8d01607128be3e&id=79f4a91ad0&f_id=005f17e1f0"
              method="post"
              id="mc-embedded-subscribe-form"
              name="mc-embedded-subscribe-form"
              class="validate"
              target="_blank"
            >
              <div
                class="flex flex-col mx-auto mt-6 space-y-3 md:space-y-0 md:flex-row"
              >
                <input
                  id="mce-EMAIL"
                  type="email"
                  name="EMAIL"
                  class="px-4 py-2 text-gray-700 bg-white border rounded-md dark:bg-gray-900 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 dark:focus:border-blue-300 focus:outline-none focus:ring focus:ring-opacity-40 focus:ring-blue-300"
                  placeholder="Email Address"
                />

                <input
                  type="submit"
                  name="subscribe"
                  value="Subscribe"
                  id="mc-embedded-subscribe"
                  class="w-full px-6 py-2.5 text-sm font-medium tracking-wider text-white transition-colors duration-300 transform md:w-auto md:mx-4 focus:outline-none bg-gray-800 rounded-lg hover:bg-gray-700 focus:ring focus:ring-gray-300 focus:ring-opacity-80"
                />
              </div>
              <div id="mce-responses" class="clear foot">
                <div
                  class="response"
                  id="mce-error-response"
                  style="display: none;"
                >
                </div>
                <div
                  class="response"
                  id="mce-success-response"
                  style="display: none;"
                >
                </div>
              </div>
              <div
                aria-hidden="true"
                style="position: absolute; left: -5000px;"
              >
                /* real people should not fill this in and expect good things -
                do not remove this or risk form bot signups */
                <input
                  type="text"
                  name="b_71ac69d566f8d01607128be3e_79f4a91ad0"
                  tabindex="-1"
                  value=""
                />
              </div>
            </form>
          </div>
        </div><div class="sm:flex-1 px-4">
          <Image
            class="rounded-md relative z-10"
            src={"/book-table.jpeg"}
            width={400}
            height={500}
            alt={book.title}
            format={"avif"}
            loading={"eager"}
          />
        </div>
      </div>
    </div>
  </div>
</div>
